# Minimal Structural Reranking Pipeline

This is a stripped down version of the reranking pipeline (no question classification/focus identification).  

With this software you will be able to apply structural reranking on a question answering dataset.  

To be more specific, the structures generated by the pipeline are enriched with relational information whenever the tree of the question and the tree of a candidate passage share the same lemmas at leaf level.

## ------ UPDATE! 19/03/2015 8pm ------

Please pull the latest version of the pipeline with:

```
git pull origin master
```

* Added automatic generation of types in Maven. No need to run generate-types.sh (removed now)
* XML descriptor files are now copied in Maven target directories during build

## ------ UPDATE! 19/03/2015 8pm ------

## References to documentation and tutorials

* https://uima.apache.org/documentation.html  
* https://uima.apache.org/uimafit.html  
* https://dkpro-tutorials.googlecode.com/svn/de.tudarmstadt.ukp.dkpro.tutorial/tags/dkprointro20130529/dkproIntroCore.pdf  

## Prerequisites

### UIMA

Go to https://uima.apache.org/downloads.cgi and download the latest binary distribution of UIMA.  

Decompress the archive and set the $UIMA_HOME environmental variable to the
UIMA distribution directory. If you use Linux or Mac please set the variable with:

```
export UIMA_HOME="path/to/dir/of/uima"
```

Add the line to  ~/.bashrc or ~/.bash_profile in order to automatically set the variable in the future.

### Maven

You will need Maven for building this project. Install maven for your operating system (e.g. sudo
apt-get install maven).  



Follow the instructions contained 

## Installation

Clone the minimal pipeline from the repository with:

```
git clone https://github.com/Anton87/minimalpipeline.git minimalpipelineita
```

## ------ UPDATE! 01/07/2015 1pm ------

### TextPro

You will need TextPro 1.5.2 to build this project. TextPro is not provided with the pipeline.

```

unzip TextPro1.5.2_Linux64bit.zip -d /path/to/project/tools

```

Follow the instructions written in the README file of your TextPro distribution to properly install TextPro.


Go to the project main directory and type:

```
mvn compile
```

Then

```
mvn -DskipTests clean dependency:copy-dependencies package
```

## Running the pipeline

```
./run.sh
```

Look into the run.sh script and the arguments/trec-it-pipeline-arguments.first20questions.txt file to understand what is happening.  

The first run will take time since Maven is downloading JARs and model files.  

## Running an experiment

### Compiling SVMLightTK

Go to the tools/SVM-Light-1.5-rer/ folder and type:

```
  make clean  
  make
```

### The experiment
The experiment consists into reranking candidate answer passages related to questions from the TREC dataset.
This dataset contains 20 questions and their answer passages. The candidate answer passages  were searched in the italian language version of Wikipedia. The latter was indexed and queries using the question terms in order to retrieved a list of related passages.
<!-- This dataset contains 824 questions and their answer patterns. The candidate answer passages come from the AQUAINT corpus. The latter was indexed and queried using the question terms in order to retrieve a list of related passages. -->

`data/trec-it/train2393.num-recovered.questions.head20.txt` contains the questions

`data/trec-it/lucene.BM25_it.first20questions.txt` contains the candidate answer passages

### The pipeline

The `TrecPipelineRunner` program is used to execute the pipeline which analyzes questions and passages and produces training and test data for the reranking task.

The program arguments are:

`arguments/trec-it-pipeline-arguments.first20questions.txt`

This file contains all the actual arguments of the program.

```
-trainQuestionsPath data/trec-it/train2393.num-recovered.questions.head20.txt 

-trainCandidatesPath data/trec-it/lucene.BM25_it.first20questions.txt  

-trainCasesDir CASes/trec-it/  

-trainOutputDir data/trec-it/train/

-testQuestionsPath data/trec-it/train2393.num-recovered.questions.head20.txt  

-testCandidatesPath data/trec-it/lucene.BM25_it.first20questions.txt  

-testCasesDir CASes/trec-it/  

-testOutputDir data/trec-it/test/  

-candidatesToKeepInTrain 10  

-candidatesToKeepInTest 50  

-lang it  
```

The same files are passed in both training and testing since we will generate the training and test data in a cross validation fashion.

The Java virtual machine arguments are the following:

`-Djava.util.logging.config.file="resources/logging.properties"`

This argument sets the logging properties.

After the execution of the pipeline, in `data/trec-it/` there will be the `train` and `test` folders with the data required for the experiment.

### Settings

The candidates kept for training are 10 while the candidates kept for testing are 20.

<!-- Out of 824 questions only 416 are used to generate training examples because the others do not have valid candidate passages in the top-50 candidates list. -->

### Producing the folds

Run:

```
python scripts/folds.py data/trec-it/ 3
```

in order to take the training and testing examples produced by the pipeline and split them into three folds. The scripts assumes that the train and test data are contained in the given directory.

### Learning, reranking and evaluation

The command:

```
python scripts/svm_run_cv.py --params="-t 5 -F 3 -C + -W R -V R -m 400" --ncpus 2 data/trec-it/folds/
```

will launch the learning, the reranking and eventually, the evaluation, which will be carried out on the single folds. Also metrics averaged on all folds will be print on screen. The `--ncpus` parameter can be used to parallelize the jobs.
 
## Examples and tutorial

You can find examples about the framework in the following package:

```
src/test/java/qa/qcri/qf/tutorial
```

Please go through the provided code and comments in order to have a better idea of the framework.

## Development in Eclipse

### Maven

If you use Eclipse please install the M2E plugin. Go to Help > Install new software... and search
for m2e.  

### UIMA tooling for Eclipse

UIMA tooling simplifies the development of typesystems and annotators in Eclipse. Install Eclipse EMF
following these instructions: http://tinyurl.com/UIMA4ECLIPSE. The useful UIMA visual
tools (UIMA tooling) can be found at this software update address:
http://www.apache.org/dist/uima/eclipse-update-site/.

### Importing the project into Eclipse

Import the project into Eclipse by clicking on File -> Import -> Existing Maven Projects. Select the pipeline folder and click on Finish.
